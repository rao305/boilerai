<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Clado/OpenAI Toggle</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .container { max-width: 800px; margin: 0 auto; }
        .toggle { margin: 20px 0; padding: 10px; background: #2a2a2a; border-radius: 8px; }
        .toggle button { margin: 5px; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
        .toggle button.active { background: #0066cc; color: white; }
        .toggle button:not(.active) { background: #444; color: #ccc; }
        .chat { background: #2a2a2a; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .message { margin: 10px 0; padding: 10px; border-radius: 8px; }
        .user { background: #0066cc; text-align: right; }
        .assistant { background: #333; }
        input { width: 70%; padding: 10px; background: #333; border: 1px solid #555; color: #fff; border-radius: 4px; }
        button { padding: 10px 20px; background: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .status { padding: 10px; background: #004400; border-radius: 4px; margin: 10px 0; }
        .error { background: #440000; }
        .suggestions { margin: 10px 0; }
        .suggestion { display: inline-block; margin: 5px; padding: 5px 10px; background: #444; border-radius: 20px; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔗 Clado/OpenAI Toggle Test</h1>
        
        <div class="toggle">
            <h3>AI Service:</h3>
            <button id="cladoBtn" onclick="setService('clado')">Clado (LinkedIn)</button>
            <button id="openaiBtn" onclick="setService('openai')" class="active">OpenAI</button>
            <div id="serviceStatus"></div>
        </div>
        
        <div class="chat" id="chat">
            <div class="message assistant">
                Welcome! Toggle between Clado (LinkedIn search) and OpenAI (general AI) services above.
            </div>
        </div>
        
        <div>
            <input type="text" id="messageInput" placeholder="Type your message..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()">Send</button>
        </div>
        
        <div class="suggestions" id="suggestions">
            <!-- Dynamic suggestions will appear here -->
        </div>
        
        <div class="status" id="status">
            Ready - Using OpenAI service
        </div>
    </div>

    <script>
        let currentService = 'openai';
        
        function setService(service) {
            currentService = service;
            document.getElementById('cladoBtn').classList.toggle('active', service === 'clado');
            document.getElementById('openaiBtn').classList.toggle('active', service === 'openai');
            
            const status = document.getElementById('status');
            const serviceStatus = document.getElementById('serviceStatus');
            
            if (service === 'clado') {
                status.textContent = 'Ready - Using Clado (LinkedIn Search)';
                serviceStatus.innerHTML = '<div style="color: #66ccff; font-size: 12px;">LinkedIn Search Active</div>';
                updateSuggestions(['Software engineers at Google', 'Purdue alumni in machine learning', 'Data scientists in San Francisco', 'Product managers with MBA']);
            } else {
                status.textContent = 'Ready - Using OpenAI';
                serviceStatus.innerHTML = '<div style="color: #66ff66; font-size: 12px;">General AI Active</div>';
                updateSuggestions(['Suggest a 15-credit schedule', 'Explain prereqs for CS 38100', 'Find STAT courses that fit Monday/Wednesday']);
            }
        }
        
        function updateSuggestions(suggestions) {
            const container = document.getElementById('suggestions');
            container.innerHTML = suggestions.map(s => 
                `<span class="suggestion" onclick="setInput('${s}')">${s}</span>`
            ).join('');
        }
        
        function setInput(text) {
            document.getElementById('messageInput').value = text;
        }
        
        function addMessage(role, content) {
            const chat = document.getElementById('chat');
            const message = document.createElement('div');
            message.className = `message ${role}`;
            message.textContent = content;
            chat.appendChild(message);
            chat.scrollTop = chat.scrollHeight;
        }
        
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (!message) return;
            
            addMessage('user', message);
            input.value = '';
            
            const status = document.getElementById('status');
            status.textContent = 'Sending...';
            
            try {
                let response;
                
                if (currentService === 'clado') {
                    // Test Clado integration
                    if (message.toLowerCase().includes('engineer') || message.toLowerCase().includes('linkedin') || 
                        message.toLowerCase().includes('professional') || message.toLowerCase().includes('alumni')) {
                        
                        // Simulate Clado LinkedIn search
                        response = await fetch('https://search.clado.ai/api/search?' + new URLSearchParams({
                            query: message,
                            limit: 3
                        }), {
                            headers: {
                                'Authorization': 'Bearer lk_26267cec2bcd4f34b9894bc07a00af1b'
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            let formattedResult = `Found ${data.results.length} LinkedIn professionals:\\n\\n`;
                            
                            data.results.forEach((result, i) => {
                                const profile = result.profile;
                                formattedResult += `${i + 1}. **${profile.name}**\\n`;
                                if (profile.headline) formattedResult += `   ${profile.headline}\\n`;
                                if (profile.location) formattedResult += `   📍 ${profile.location}\\n`;
                                if (profile.linkedin_url) formattedResult += `   🔗 ${profile.linkedin_url}\\n`;
                                formattedResult += '\\n';
                            });
                            
                            addMessage('assistant', formattedResult);
                            status.textContent = 'Ready - Using Clado (LinkedIn Search)';
                            return;
                        }
                    } else {
                        // For non-LinkedIn queries in Clado mode, use backend
                        response = await fetch('http://localhost:5003/chat', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                message: message,
                                context: { userId: 'test_user' }
                            })
                        });
                    }
                } else {
                    // OpenAI mode - simulate OpenAI response
                    addMessage('assistant', `[OpenAI Response] I'd be happy to help with "${message}". This would be a response from OpenAI's API with academic advice and course planning guidance.`);
                    status.textContent = 'Ready - Using OpenAI';
                    return;
                }
                
                if (response && response.ok) {
                    const data = await response.json();
                    addMessage('assistant', data.response || 'No response received');
                } else {
                    throw new Error('Service unavailable');
                }
                
                status.textContent = `Ready - Using ${currentService === 'clado' ? 'Clado' : 'OpenAI'}`;
                
            } catch (error) {
                addMessage('assistant', `Error: ${error.message}. ${currentService === 'clado' ? 'Clado API or backend service may be unavailable.' : 'OpenAI service may be unavailable.'}`);
                status.className = 'status error';
                status.textContent = `Error - ${currentService} service unavailable`;
                
                setTimeout(() => {
                    status.className = 'status';
                    status.textContent = `Ready - Using ${currentService === 'clado' ? 'Clado' : 'OpenAI'}`;
                }, 3000);
            }
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        // Initialize
        setService('openai');
    </script>
</body>
</html>